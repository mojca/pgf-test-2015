% Copyright 2011 by Jannis Pohlmann
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Free Documentation License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\section{Standard Graph Drawing Algorithms}
\label{section-library-graphdrawing-standard}

{\emph{by Jannis Pohlmann}}

\begin{tikzlibrary}{graphdrawing.standard}
  This package needs to be loaded in order to use any of the automatic
  graph drawing algorithms described in this chapter. It extends the
  |graphdrawing| package by a set of standard graph drawing 
  algorithms and provides \tikzname\ options for selecting and 
  configuring them.
\end{tikzlibrary}

\subsection{Orientation of Graph Drawings}
\label{subsection-library-graphdrawing-standard-orientation}

The drawing computed for a graph may be pleasing in general but some
algorithms like the |spring| algorithm show the tendency to generate
drawings with an unexpected orientation. Also, if several graphs are 
defined in a single |{tikzpicture}| then these will possibly overlap.
As a consequence, a postprocessing step is sometimes necessary in order
to adjust the orientation of the graph drawing. This can be achieved in
a relatively simple way using the options described here.

\begin{key}{/tikz/orient=\meta{orientation}}
  With graph drawing algorithms it makes sense for, the |graphdrawing|
  library will, in a postprocessing step, attempt to detect the 
  principal axis of the graph automatically and will adjust its 
  orientation so that it is parallel to the $x$ axis.

  This behavior may be altered by setting |orientation| using one of
  the following three notation styles:

  \meta{first axis node}-\meta{second axis node} specifies the axis of
  the graph drawing via the names of two nodes. The drawing is rotated
  so that this axis is parallel to the $x$ axis, with \meta{first axis
  node} being located left of \meta{second axis node}:
  \begin{codeexample}[]
\tikz \graph [spring electrical layout] { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=a-b] { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=b-a] { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=1-2] { subgraph K_n[n=5] };
\tikz \graph [spring electrical layout,orient=2-1] { subgraph K_n[n=5] };
  \end{codeexample}

  \meta{first axis node}TODO\meta{second axis node} again specifies the
  axis of the graph drawing via the names of two nodes. The drawing is
  rotated so that this axis is orthogonal to the $x$ axis (and thereby 
  parallel to the $y$ axis), with \meta{first axis node} being located
  above \meta{second axis node}:
  \begin{codeexample}[]
\tikz \graph [spring electrical layout,orient=a|b] { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=b|a] { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=1|4] { subgraph K_n[n=5] };
\tikz \graph [spring electrical layout,orient=4|1] { subgraph K_n[n=5] };
  \end{codeexample}

  \meta{first axis node}:\meta{angle}:\meta{second axis node} is the
  most generic variant of the three notation styles. In addition to
  specifying the axis of the graph drawing by means of two node names,
  it also defines the angle to the $x$ axis by which the final drawing 
  is to be rotated. The specification of the \meta{angle} is done in the
  same way as everywhere else in \tikzname, where positive values imply
  counter-clockwise rotation and negative values imply clockwise
  rotation:
  \begin{codeexample}[]
\tikz \graph [spring electrical layout,orient=a:90:b]  { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=a:45:b]  { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=a:0:b]   { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=a:-45:b] { a -- b -- c -- a };
\tikz \graph [spring electrical layout,orient=a:-90:b] { a -- b -- c -- a };
  \end{codeexample}
\end{key}

\begin{key}{/tikz/orient'=\meta{orientation}}
  Does the same as |orient| except that the nodes are flipped over the
  principal axis.
  \begin{codeexample}[]
\tikz \graph [spring layout,orient=a-b]  { a -- b -- c -- a };
\tikz \graph [spring layout,orient'=a-b] { a -- b -- c -- a };
  \end{codeexample}
\end{key}

%\begin{key}{/tikz/desired at=\marg{coordinate}}
%  Defines the desired position for a node. In a postprocessing step, the
%  |graphdrawing| library will attempt to move the entire graph so that
%  the first node with a |desired at| option is moved to its desired 
%  location.
%  \begin{codeexample}[]
%% TODO
%  \end{codeexample}
%\end{key}

%\subsection{Packing of Connected Components}
%
%Graphs may be composed of subgraphs or \emph{components} that are not
%connected to each other. In order to draw these nicely, the 
%|graphdrawing| library splits them up into separate graphs, computes
%their layouts with the same graph drawing algorithm independently and,
%in a postprocessing step, arranges them in a non-uniform grid in the 
%final drawing. This is called \emph{component packing}.
%
%The following options can be used to configure the order and placement
%strategy during component packing.
%
%\begin{key}{/tikz/component packing=\marg{options}}
%  Executes the \meta{options} with the path prefix 
%  |/tikz/component packing|.
%  
%  Defines how to arrange the connected components of the graph after 
%  their individual drawings have been computed.
%\end{key}
%
%\begin{key}{/tikz/component packing/layered=\opt{\meta{boolean}} (default true, initially true)}
%  |layered| arranges the different components in a non-uniform grid
%  starting in the top left corner. Components are placed in these 
%  layers in descending order of their size.
%  \begin{codeexample}[]
%\tikz \graph [experimental layout,component packing={layered}] {
%  a -- b -- c -- a,
%  d -- e -- d,
%  g
%};
%  \end{codeexample}
%\end{key}
%
%\begin{key}{/tikz/component packing/centered=\opt{\meta{boolean}} (default true, initially false)}
%  If set to |true|, arranges the different components clockwise in a 
%  non-uniform grid starting at the center. Components are placed in 
%  descending order of their size.
%  \begin{codeexample}[]
%\tikz \graph [experimental layout,component packing={centered}] {
%  a -- b -- c -- a,
%  d -- e -- d,
%  g
%};
%  \end{codeexample}
%\end{key}
%
%\begin{key}{/tikz/component packing/padding=\meta{dimension} (initially 0pt)}
%  Defines how much padding is used to separate the connected 
%  components.
%  \begin{codeexample}[]
%\tikz \graph [experimental layout,component packing={centered,padding=10pt}] {
%  a -- b -- c -- a,
%  d -- e -- d,
%  g
%};
%  \end{codeexample}
%\end{key}

\section{The Spring and Spring-Electrical Drawing Algorithms}

\subsection{Overview}

% TODO explain the spring and spring-electrical drawing algorithms.

...

\subsection{Common Options}

The spring and and spring-electrical drawing algorithms are very similar
in terms of their parameters and the constraints they can handle. They
thus share a number of common \tikzname\ options for fine-tuning. These
options are split up into \emph{graph options} that can be specified
once for a graph, \emph{node options} that can be specified for each
node and \emph{edge options} that can be specified for each edge.

\subsubsection{Graph Options}

\begin{key}{/tikz/monotonic energy minimization=\opt{\meta{boolean}} 
  (default true, initially false)}
  If set to |true|, requires a step along the force to reduce the
  system energy. If set to |false| even steps that do not lower the 
  system energy are accepted.
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/influence cutoff distance=\meta{dimension} (initially
  0pt)}
  Specifies a distance beyond which the attractive and repulsive forces 
  between two nodes are assumed to be virtually non-existent. If 
  \meta{dimension} is set to |0pt|, the cutoff distance is computed 
  automatically.

  Depending on the graph drawing algorithm being used, the distance
  between two nodes is computed either based on the graph distance
  (spring algorithm) or based on the Euclidean distance
  (spring-electrical algorithm).
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/maximum iterations=\meta{number} (initially 500)}
  Depending on the characteristics of the input graph and the parameters
  chosen for the spring or spring-electrical algorithm, minimizing the
  system energy may require many iterations. In rare cases and only if
  |monotonic energy minimization| and |monotonic step control| are
  turned off, the graph drawing algorithm may not even terminate.

  In these situations it may come in handy to limit the number of
  iterations. This feature can also be useful to draw the same graph
  after different iterations and thereby demonstrate how the spring or
  spring-electrical algorithm improves the drawing step by step.
  \begin{codeexample}[]
\tikz \graph [spring layout,maximum iterations=1]   { a -- b -- c -- a };
\tikz \graph [spring layout,maximum iterations=10]  { a -- b -- c -- a };
\tikz \graph [spring layout,maximum iterations=500] { a -- b -- c -- a };
  \end{codeexample}
\end{key}

\begin{key}{/tikz/random seed=\meta{number} (initially 42)}
  Specifies the seed used for Lua's pseudo-random number generator. If
  set to something other than |0|, the random number sequence generated
  by the pseudo-random number generator will be the same at every run.
  If set to |0|, the results will be different every time.
  \begin{codeexample}[width=5.5cm]
\tikz \graph [spring electrical layout,random seed=1] { 
  subgraph K_n[n=4]
};
\tikz \graph [spring electrical layout,random seed=10] { 
  subgraph K_n[n=4]
};
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening=\marg{options}}
  Executes the \meta{options} with the path prefix |/tikz/coarsening|.
  
  These options define whether a multilevel approach is used that
  successively coarsend into graphs with smaller and smaller number
  of nodes. These graphs are arranged first and are then interpolated
  into the finer graphs at the previous level. How this is done exactly
  can be configured using the |coarsening| options described below.
\end{key}

\begin{key}{/tikz/coarsening/randomized=\opt{\meta{boolean}} (default
  true, initially false)}
  If set to |true|, nodes will be inspected in a random order. The
  effect on the final drawing can only be seen by experimenting with the
  option.
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/minimum size=\meta{number} (default 0)}
  Defines the minimum number of nodes in a coarsened graph. If a
  coarsened graph has less than \meta{number} nodes, then... % TODO
  \begin{codeexample}[] 
% the same graph with different minimum size values
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/nodes=\opt{\meta{boolean}} (default true,
  initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/nearby nodes=\opt{\meta{boolean}} (default
  true, initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/nodes with more 
  neighbors=\opt{\meta{boolean}} (default true, initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/nearby nodes with more 
  neighbors=\opt{\meta{boolean}} (default true, initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/edges=\opt{\meta{boolean}} (default true,
  initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/heavy edges=\opt{\meta{boolean}} (default
  true, initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/coarsening/edges with light nodes=\opt{\meta{boolean}}
  (default true, initially false)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/minimum energy delta=\meta{number} (default TODO)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/initial step size=\meta{dimension} (default TODO)}
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\begin{key}{/tikz/step control=\meta{text} (default TODO)}
  Possible values: |monotonic|, |non-monotonic|, |strictly monotonic|.
  \begin{codeexample}[]
  \end{codeexample}
\end{key}

\subsubsection{Node Options}

%\begin{key}{/tikz/electric charge=\meta{number} (default 1)}
%  Defines the electric charge of the node. The stronger the electric
%  charge, the higher the repulsive force between two nodes. Set this to
%  something between |0| and |1| to reduce the charge compared to the
%  normal setup. Values larger than |1| will generate stronger repulsion
%  between the node and the others.
%  \begin{codeexample}[] 
%\tikz \graph [spring electrical layout,orient=1:90:2] {
%  1 -- 2 -- 3 -- 4 -- 1,
%  1 -- 3, 2 -- 4,
%};
%\tikz \graph [spring electrical layout,orient=1:90:2] {
%  1 [electric charge=1] -- 2 -- 3 -- 4 -- 1,
%  1 -- 3, 2 -- 4,
%};
%\tikz \graph [spring electrical layout,orient=1:90:2] {
%  1 [electric charge=1000] -- 2 [electric charge=1000] -- 3 -- 4 -- 1,
%  1 -- 3, 2 -- 4,
%};
%  \end{codeexample}
%\end{key}

%\end{document}

\begin{key}{/tikz/at=\meta{coordinate}}
  Nails the node down at the specified \meta{coordinate}. It will not
  move from there despite the repulsive and attractive forces in the
  system. Note that, while sometimes generating a similar effect, using
  |at| is very different from altering the orientation of a graph
  drawing (see section~\ref{subsection-library-graphdrawing-standard-orientation}).
  Also, if an orientation is specified, it is given priority over
  the |at| option in that nodes are first fixated at their |at|
  coordinates but are later moved in order to satisfy the orientation 
  desired by the user.
  \begin{codeexample}[width=6.0cm]
\tikz \graph [spring electrical layout] {
  1 -- 2 -- 3 -- 4 -- 2
};
\tikz \graph [spring electrical layout] {
  1 [at={(0,0)}] -- 2 [at={(0,1)}] -- 3 -- 4 -- 2
};
  \end{codeexample}
\end{key}


% TODO what about node groups / clusters? This works via color classes
% but how do we define their layouts (cluster, line, circle)?

\subsubsection{Edge Options}

\begin{key}{/tikz/natural length=\meta{dimension} (default 10pt)}
  Defines the natural (zero energy) length of the edge. The smaller the
  length, the stronger the attractive force of the adjacent nodes. The
  \meta{dimension} has a strong influence of how far the nodes will be
  placed from each other in the final drawing.
  \begin{codeexample}[]
% two examples with the same graph
% notably change the natural length of one of the edges
  \end{codeexample}
\end{key}

\begin{key}{/tikz/stiffness=\meta{number} (default 0.5)}
  Defines how flexible the spring associated with the edge is. The
  higher this value is, the closer the final edge length will be to its
  |natural length|.
  \begin{codeexample}[]
% two examples with the same graph
% notably change the stiffness of one of the edges
  \end{codeexample}
\end{key}

\subsection{Options for the Spring Algorithm}

\subsubsection{Graph Options}

...

\subsubsection{Node Options}

...

\subsubsection{Edge Options}

...

\subsection{Options for the Spring-Electrical Algorithm}

\subsubsection{Graph Options}

...

\subsubsection{Node Options}

...

\subsubsection{Edge Options}

...

\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=0,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=1,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=2,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=3,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=4,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=5,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=6,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=7,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=8,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=9,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=10,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=11,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=12,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=13,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=14,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=15,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=16,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=17,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=18,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=19,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=20,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=21,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=22,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=23,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=24,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=25,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=100,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}
\begin{codeexample}[]
\tikz \graph [spring electrical layout,
              maximum iterations=500,
              orient=1-2] {
  subgraph K_n[n=4]
};
\end{codeexample}

%% TODO
%% Explain the following concepts:
%% - separation of graph drawing options and regular TikZ options
%% - generic graph drawing options:
%%   - component packing
%%   - orientation
%% - pre-defined graph drawing styles
%% - graph drawing options for fine-tuning the different algorithms

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "pgfmanual-pdftex-version"
%%% End: 
