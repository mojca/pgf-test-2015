% Copyright 2006 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS $Header: /cvsroot/pgf/pgf/generic/pgf/systemlayer/pgfsys-xetex.def,v 1.6 2013/06/21 12:25:39 tantau Exp $

\input pgfsys-dvipdfmx.def

\def\pgfsys@dvipdfmx@patternobj#1{%
	% I have NO idea why this is necessary for xdvipdfmx - but without
	% it, it crashes.
	\pgfutil@insertatbegincurrentpagefrombox{#1}%
}%

% XeTeX supports pdftex commands for paper size
\def\pgfsys@papersize#1#2{%
  \pdfpageheight#2%
  \pdfpagewidth#1}
  

  
% XeTeX supports position tracking, now
\def\pgfsys@markposition#1{%
  \pdfsavepos%
  \edef\pgf@temp{#1}%
  \expandafter\pgfutil@writetoaux\expandafter{%
    \expandafter\noexpand\expandafter\pgfsyspdfmark\expandafter{\pgf@temp}{\the\pdflastxpos}{\the\pdflastypos}}%
}

\def\pgfsyspdfmark#1#2#3{%
  \expandafter\gdef\csname pgf@sys@pdf@mark@pos@#1\endcsname{\pgfqpoint{#2sp}{#3sp}}%
}

\def\pgfsys@getposition#1#2{%
  \edef\pgf@marshal{\let\noexpand#2=\expandafter\noexpand\csname pgf@sys@pdf@mark@pos@#1\endcsname}%
  \pgf@marshal%
}

\def\pgf@sys@pdf@mark@pos@pgfpageorigin{\pgfqpoint{2\hoffset}{0pt}}

\ifx\paperheight\@undefined
\else
  \pdfpagewidth\paperwidth
  \pdfpageheight\paperheight % this is to work around a positioning problem in xetex.
\fi



\endinput
